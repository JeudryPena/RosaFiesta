<div class="row">
    <div class="col">
        <div class="card text-start p-0">
            <div class="card-body">
                <div class="row">
                    <caption class="col">Descuentos&nbsp;&nbsp;<button type="button" class="btn btn-primary btn-add"
                            ngbAutofocus (click)="AddDiscount()">
                            Añadir Descuento
                        </button></caption>
                    <span class="col col-sm-auto col-form-label" *ngIf="service.loading$ | async">
                        <i class="fas fa-spinner fa-spin"
                            style="color: #32CD32; display: inline-block; margin-right: 5px;"></i>
                        <span style="color: #32CD32; display: inline-block;">Cargando..</span>
                    </span>
                    <div class="col-xs-3 col-sm-auto input-group-sm d-flex search-container align-items-center">
                        <input id="table-complete-search" type="text" class="form-control searcher" name="searchTerm"
                            [(ngModel)]="service.searchTerm" placeholder="Buscar..." aria-label="Buscar" />
                    </div>
                </div>
                <div class="table-responsive" style="overflow-x: auto;">
                    <table class="table table-striped table-hover align-middle ">
                        <thead class="tables">
                            <tr class="table-row">
                                <th scope="col" class="table-cell" sortable="code" (sort)="onSort($event)">Código</th>
                                <th scope="col" class="table-cell" sortable="title" (sort)="onSort($event)">Nombre</th>
                                <th scope="col" class="table-cell">Descripción</th>
                                <th scope="col" class="table-cell">Valor</th>
                                <th scope="col" class="table-cell">Máx.</th>
                                <th scope="col" class="table-cell">
                                    <div class="input-group">
                                        <span class="badge text-bg-success">
                                            Inicio
                                        </span>
                                        <span class="badge text-bg-danger">
                                            Fin
                                        </span>
                                    </div>
                                     </th>
                                <th scope="col" class="table-cell">
                                    Productos</th>
                                <th scope="col" class="table-cell">
                                    Creación</th>
                                <th scope="col" class="table-cell">
                                    Modificación</th>
                                <th scope="col" class="table-cell"></th>
                            </tr>
                        </thead>

                        <tbody class="rows">
                            <tr class="scroll" *ngFor="let item of discounts$ | async ">
                                <td><ngb-highlight [result]="item.code" [term]="service.searchTerm"></ngb-highlight>
                                <td><ngb-highlight [result]="item.name" [term]="service.searchTerm"></ngb-highlight>
                                </td>
                                <td><ngb-highlight [result]="item.description | truncate:25"  placement="top" ngbTooltip="{{item.description}}" [term]="service.searchTerm"></ngb-highlight>
                                </td>
                                <td>
                                    <ngb-highlight [result]="item.value | number"
                                        [term]="service.searchTerm"></ngb-highlight>
                                        <span *ngIf="item.type == 1">%</span>
                                </td>
                                <td><ngb-highlight [result]="item.maxTimesApply | number"
                                        [term]="service.searchTerm"></ngb-highlight></td>
                                <td><ngb-highlight class="badge text-bg-success" [result]="item.start | date: 'dd/MM/yyyy hh:mm:ss' "
                                    [term]="service.searchTerm"></ngb-highlight>
                                    <br>
                                    <ngb-highlight class="badge text-bg-danger" [result]="item.end | date: 'dd/MM/yyyy hh:mm:ss'" [term]="service.searchTerm"></ngb-highlight>
                                </td>
                                <td>
                                    <div *ngFor="let productDiscount of item.productsDiscounts" class="d-flex justify-content-between">
                                        <div ngbDropdown container="body">
                                            <span class="badge text-bg-primary" ngbDropdownToggle>
                                                {{productDiscount.optionId}}
                                            </span>
                                            <div ngbDropdownMenu>
                                                <button ngbDropdownItem (click)="DeleteProducts(productDiscount.code, productDiscount.optionId)"><i
                                                        class="fa-solid fa-trash pe-2"></i>Eliminar</button>
                                                <button ngbDropdownItem
                                                    (click)="DeleteProducts(productDiscount.code, null)"><i
                                                        class="fa-solid fa-trash pe-2"></i>Eliminar todos</button>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td><ngb-highlight class="badge text-bg-dark" [result]="item.createdAt | date: 'dd/MM/yyyy hh:mm:ss'" placement="top"
                                        ngbTooltip="Creado por: {{item.createdBy}}" [term]="service.searchTerm"></ngb-highlight>
                                <td><ngb-highlight class="badge text-bg-secondary" [result]="item.updatedAt | date: 'dd/MM/yyyy hh:mm:ss'"
                                        placement="top" ngbTooltip="Modificado por: {{item.updatedBy}}" [term]="service.searchTerm"></ngb-highlight>
                                </td>
                                <td class="overflow-hidden">
                                    <div ngbDropdown container="body">
                                        <button type="button" class="btn btn-outline-primary btn-sm btn-dropdown" ngbDropdownToggle></button>
                                        <div ngbDropdownMenu>
                                            <button ngbDropdownItem (click)="Retrieve(item.code)"><i class="fa-solid fa-eye pe-2"></i>Ver</button>
                                            <button ngbDropdownItem (click)="Modify(item.code)"><i class="fa-solid fa-pen pe-2"></i>Modificar</button>
                                            <div class="dropdown-divider"></div>
                                            <button ngbDropdownItem (click)="Delete(item.code)"><i class="fa-solid fa-trash pe-2"></i>Eliminar</button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                        </tfoot>
                    </table>
                </div>
                <div class="d-flex justify-content-between p-2">
                    <pre>Current page: {{service.page}}</pre>
                    <ngb-pagination [collectionSize]="(total$ | async)!" [(page)]="service.page"
                        [pageSize]="service.pageSize" [collectionSize]="collectionSize" [maxSize]="maxSize"
                        [rotate]="true" [boundaryLinks]="true" size="sm">
                    </ngb-pagination>
                    <div class="row">
                        <pre class="col">Filas</pre>
                        <select class="form-select " style="width: auto" name="pageSize" [(ngModel)]="service.pageSize">
                            <option [ngValue]="5">5</option>
                            <option [ngValue]="10">10</option>
                            <option [ngValue]="15">15</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>